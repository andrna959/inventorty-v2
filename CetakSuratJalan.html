<!DOCTYPE html>
<html lang="id">
<head>
  <title>Delivery Order - PT Social Bella Indonesia</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
  
  <style>
    /* --- 1. GLOBAL RESET & PAPER SETUP --- */
    body { 
      font-family: 'Roboto', sans-serif; 
      font-size: 11px;
      color: #000; 
      margin: 0; 
      padding: 20px;
      -webkit-print-color-adjust: exact; 
      background-color: #eee;
    }
    
    .paper {
        background: white;
        width: 210mm;
        min-height: 297mm;
        margin: 0 auto;
        padding: 1cm;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        position: relative;
    }

    @page { size: A4; margin: 0; }
    @media print { 
        body { background: none; padding: 0; margin: 0; }
        .paper { box-shadow: none; margin: 0; width: 100%; max-width: 210mm; padding: 1cm; }
        .no-print { display: none !important; } 
    }
    
    /* --- 2. HEADER SECTION (REVISI: STRUKTUR UNTUK GARIS PANJANG) --- */
    .header-wrapper { 
        display: block; 
        margin-bottom: 25px; 
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px; /* Jarak antara teks dan garis */
    }
    
    .company-branding { width: 70%; }
    
    .company-logo { 
        font-size: 22px; 
        font-weight: 800; 
        text-transform: uppercase; 
        letter-spacing: -0.5px; 
        margin-bottom: 5px; 
        color: #ec4899; 
    }
    .company-logo span { color: #ec4899; } /* Pastikan span teks PT juga pink */
    
    .company-detail { 
        font-size: 10px; 
        line-height: 1.4; 
        color: #444; 
    }

    .doc-branding { width: 30%; text-align: right; }
    
    /* STYLE GARIS PANJANG HITAM */
    .header-line {
        border: 0;
        border-top: 2px solid #000; 
        margin: 0;
        width: 100%;
    }

    /* --- 3. INFO BOXES --- */
    .info-grid { display: flex; gap: 20px; margin-bottom: 25px; }
    .info-card { flex: 1; border: 1px solid #000; }
    .card-header { background-color: #e0e0e0; padding: 5px 10px; border-bottom: 1px solid #000; font-weight: 700; font-size: 10px; text-transform: uppercase; }
    .card-body { padding: 10px; }
    
    .row-item { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .label { font-weight: 500; color: #555; }
    .val { font-weight: 700; }

    /* --- 4. TABLE --- */
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10px; margin-top: 20px; }
    th { 
      background-color: #e0e0e0; 
      border: 1px solid #000; 
      padding: 8px 5px; 
      text-align: left; 
      text-transform: uppercase; 
      font-weight: 700;
    }
    td { 
      border: 1px solid #000; 
      padding: 6px 5px; 
      vertical-align: middle; 
    }
    
    .col-center { text-align: center; }
    .col-right { text-align: right; }
    .sku-font { font-family: monospace; font-weight: 700; font-size: 11px; }

    /* --- 5. FOOTER & SIGNATURES --- */
    .footer-wrapper { margin-top: 5px; page-break-inside: avoid; }
    
    .total-bar { 
      display: flex; justify-content: flex-end; align-items: center; 
      border: 1px solid #000; border-top: none; 
      padding: 8px; margin-bottom: 30px; background: #f9f9f9;
    }
    
    .notes-box { border: 1px dashed #000; padding: 10px; margin-bottom: 20px; min-height: 40px; font-style: italic; font-size: 10px; }

    .sign-grid { display: flex; justify-content: space-between; gap: 20px; }
    .sign-box { 
      flex: 1; 
      border: 1px solid #000; 
      display: flex; 
      flex-direction: column; 
    }
    .sign-head { 
      background: #e0e0e0; 
      border-bottom: 1px solid #000; 
      padding: 5px; 
      font-weight: 700; 
      font-size: 10px; 
      text-transform: uppercase; 
      text-align: center;
    }
    .sign-area { height: 100px; }
    
    .sign-footer {
      border-top: 1px solid #000;
      padding: 5px 8px;
    }
    .sign-row {
      display: flex;
      align-items: center; 
      margin-bottom: 4px;
    }
    .sign-row:last-child { margin-bottom: 0; }
    .sign-label {
      width: 45px; 
      font-size: 9px;
      color: #666;
      font-weight: 500;
    }
    .sign-input {
      flex: 1;
      border-bottom: 1px dotted #888;
      font-weight: 700;
      font-size: 10px;
      padding-left: 5px;
      min-height: 14px;
    }

    /* BUTTON */
    .print-btn { position: fixed; bottom: 30px; right: 30px; padding: 12px 25px; background: #000; color: #fff; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 999; }
    .print-btn:hover { transform: scale(1.05); }
  </style>
</head>
<body>

  <div id="loading" style="text-align:center; padding:100px;">
    <div style="font-size:18px; font-weight:bold; color:#555;">Mengambil Data...</div>
  </div>

  <div id="print-area" class="paper" style="display:none;">
    
    <div class="header-wrapper">
      <div class="header-content">
          <div class="company-branding">
            <div class="company-logo" id="c-name">PT <span>SOCIAL BELLA INDONESIA</span></div>
            <div class="company-detail" id="c-addr">
              St. Moritz Office Tower lt. 15<br>
              Jl. Puri Indah Raya, RT.3/RW.2, Kembangan Selatan<br>
              Jakarta Barat 11610, Indonesia
            </div>
          </div>
          <div class="doc-branding">
             </div>
      </div>
      <hr class="header-line">
    </div>

    <div class="info-grid">
      <div class="info-card">
        <div class="card-header">SHIP TO (PENERIMA)</div>
        <div class="card-body">
          <div id="t-cust" style="font-size:14px; font-weight:700; margin-bottom:5px;">-</div>
        </div>
      </div>
      
      <div class="info-card">
        <div class="card-header">DOCUMENT DETAILS</div>
        <div class="card-body">
          <div class="row-item"><span class="label">SENDER:</span> <span class="val">Inbound</span></div>
          <div class="row-item"><span class="label">DELIVERY NO:</span> <span class="val" id="t-id">-</span></div>
          <div class="row-item"><span class="label">DATE:</span> <span class="val" id="t-date">-</span></div>
          <span id="t-ref" style="display:none;"></span>
        </div>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th width="5%" class="col-center">NO</th>
          <th width="20%">SKU / BARCODE</th>
          <th width="30%">PRODUCT NAME</th>
          <th width="15%">BRAND</th>
          <th width="15%">BATCH</th>
          <th width="15%">EXPIRED DATE</th>
          <th width="10%" class="col-center">QTY PCS</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>

    <div class="footer-wrapper">
      <div class="total-bar">
        <span style="font-weight:700; margin-right:20px;">TOTAL QUANTITY:</span>
        <span id="t-total" style="font-size:16px; font-weight:800;">0</span>
        <span style="margin-left:5px;">PCS</span>
      </div>

      <div class="notes-box">
        <strong>NOTES / KETERANGAN:</strong><br>
        <span id="t-note">Handle with care. Temperature controlled storage required.</span>
      </div>

      <div class="sign-grid">
        <div class="sign-box">
          <div class="sign-head">PACKER</div>
          <div class="sign-area"></div>
          <div class="sign-footer">
            <div class="sign-row">
              <span class="sign-label">NAME</span>
              <span class="sign-input">Warehouse Staff</span>
            </div>
            <div class="sign-row">
              <span class="sign-label">DATE</span>
              <span class="sign-input" id="sign-date-1"></span>
            </div>
          </div>
        </div>
        
        <div class="sign-box">
          <div class="sign-head">SECURITY</div>
          <div class="sign-area"></div>
          <div class="sign-footer">
            <div class="sign-row">
              <span class="sign-label">NAME</span>
              <span class="sign-input">LP</span>
            </div>
            <div class="sign-row">
              <span class="sign-label">DATE</span>
              <span class="sign-input" id="sign-date-2"></span>
            </div>
          </div>
        </div>
        
        <div class="sign-box">
          <div class="sign-head">RECEIVED BY</div>
          <div class="sign-area"></div>
          <div class="sign-footer">
            <div class="sign-row">
              <span class="sign-label">NAME</span>
              <span class="sign-input" id="sign-cust-name"></span>
            </div>
            <div class="sign-row">
              <span class="sign-label">DATE</span>
              <span class="sign-input"></span>
            </div>
          </div>
        </div>
      </div>
      
      <div style="margin-top:20px; font-size:9px; color:#888; text-align:center;">
        System Generated: <span id="t-id-footer"></span> | Printed on <span id="print-time"></span> | Page 1 of 1
      </div>
    </div>
  </div>

  <button class="no-print print-btn" onclick="window.print()">üñ®Ô∏è CETAK DOKUMEN</button>

  <script>
    // 1. DEFINISI ID TRANSAKSI (HARUS PALING ATAS)
    var trxId = "<?= trxId ?>";

    document.addEventListener("DOMContentLoaded", function() {
       document.getElementById('print-time').innerText = new Date().toLocaleString();
       
       if(!trxId || trxId === 'undefined' || trxId === '') { 
           document.getElementById('loading').innerHTML = "<h3 style='color:red'>Error: ID Transaksi Tidak Ditemukan.</h3>";
           return; 
       }
       
       google.script.run
         .withSuccessHandler(renderData)
         .withFailureHandler(e => {
            document.getElementById('loading').innerHTML = `<h3 style='color:red'>Gagal Mengambil Data: ${e.message}</h3>`;
         })
         .getOutboundPrintData(trxId);
    });

    function renderData(data) {
       if(!data) { 
           document.getElementById('loading').innerHTML = "<h3 style='color:red'>Data Transaksi Tidak Ditemukan di Database!</h3>"; 
           return; 
       }

       document.getElementById('t-id').innerText = data.header.trxId;
       document.getElementById('t-id-footer').innerText = data.header.trxId;
       
       document.getElementById('t-cust').innerText = data.header.customer || "-";
       document.getElementById('t-date').innerText = data.header.tanggal;
       document.getElementById('t-note').innerText = data.header.notes || "-";
       
       document.getElementById('sign-cust-name').innerText = data.header.customer;
       document.getElementById('sign-date-1').innerText = data.header.tanggal;
       document.getElementById('sign-date-2').innerText = data.header.tanggal;

       const tbody = document.getElementById('table-body');
       tbody.innerHTML = ""; 
       let total = 0;

       if (data.items && data.items.length > 0) {
           data.items.forEach((item, i) => {
              total += Number(item.qty);
              let tr = `
                <tr>
                  <td class="col-center">${i+1}</td>
                  <td>
                      <div class="sku-font">${item.sku}</div>
                  </td>
                  <td>
                      <strong>${item.nama}</strong>
                  </td>
                  <td>${item.brand || '-'}</td>
                  <td>${item.batch || '-'}</td>
                  <td>${item.exp || '-'}</td>
                  <td class="col-center" style="font-weight:700; font-size: 12px;">${item.qty}</td>
                </tr>`;
              tbody.innerHTML += tr;
           });
       } else {
           tbody.innerHTML = `<tr><td colspan="7" class="col-center" style="padding:20px;">Tidak ada item barang.</td></tr>`;
       }

       document.getElementById('t-total').innerText = total;

       document.getElementById('loading').style.display = 'none';
       document.getElementById('print-area').style.display = 'block';

       setTimeout(() => window.print(), 1000);
    }
  </script>
</body>
</html>
